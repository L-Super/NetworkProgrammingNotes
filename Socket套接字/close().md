关闭连接
```c
#include <unistd.h>
int close(int fd);
/*
若成功则为0，若出错则为-1
*/
```
+ fd: 待关闭的socket
这个函数会对套接字引用计数减一，一旦套接字引用计数为0，就会对套接字进行彻底释放，并且会关闭 **TCP两个方向的数据流**。

多进程程序中，一次fork系统调用默认将使父进程中打开的socket的引用计数加1，因此我们必须在父进程和子进程中都对该socket执行close调用才能将连接关闭。

**close函数具体是如何关闭两个方向的数据流呢？**

在输入方向，系统内核会将该套接字设置为不可读，任何读操作都会返回异常。

在输出方向，系统内核尝试将发送缓冲区的数据发送给对端，并最后向对端发送一个FIN报文，接下来如果再对该套接字进行写操作会返回异常。

如果对端没有检测到套接字已关闭，还继续发送报文，就会收到一个RST报文，告诉对端：“Hi, 我已经关闭了，别再给我发数据了。”